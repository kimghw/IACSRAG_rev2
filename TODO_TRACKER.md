# TODO 및 이슈 트래커

## 🚨 긴급 수정 필요 (Critical Issues)

### 1. 데이터베이스 연결 관리 개선
**문제점:**
- 연결 풀 설정 없음
- 연결 상태 확인 없음
- 재연결 로직 없음
- 종료 시 연결 정리 없음

**해결 방안:**
```python
# infra/databases/mongo_db.py 수정 필요
- 연결 풀 설정 추가 (maxPoolSize, minPoolSize)
- ensure_connection() 메서드로 연결 상태 확인
- 자동 재연결 로직 구현
- graceful shutdown 구현
```

### 2. 트랜잭션 처리 추가
**문제점:**
- MongoDB 저장과 Qdrant 저장이 분리되어 부분 실패 시 데이터 불일치 발생 가능

**해결 방안:**
- Two-Phase Commit 패턴 구현
- 또는 Saga 패턴으로 보상 트랜잭션 구현
- 실패 시 롤백 메커니즘 추가

## 📋 기능 개선 (Enhancements)

### 1. 에러 처리 강화
- [ ] GridFS 파일 읽기 실패 시 상세 에러 처리
- [ ] Dead Letter Queue 구현
- [ ] 재시도 정책 설정 (exponential backoff)
- [ ] 실패 알림 시스템

### 2. 성능 최적화
- [ ] 대용량 파일 스트리밍 처리
- [ ] 배치 처리 크기 동적 조정
- [ ] Redis 캐싱 전략 구현
- [ ] 병렬 처리 최적화

### 3. 모니터링 및 로깅
- [ ] OpenTelemetry Trace 설정
- [ ] 메트릭 수집 (처리 시간, 성공률 등)
- [ ] 구조화된 로깅 구현
- [ ] 대시보드 구성

## 🧹 코드 정리 (Cleanup)

### 제거 가능한 코드
1. **upload_service/upload_handler.py** - 참조되지 않음
2. **upload_service/upload_validator.py** - 참조되지 않음
3. **schema.py의 ContentEvent** - 실제로 사용되지 않음

### 리팩토링 필요
- [ ] 중복 코드 제거
- [ ] 네이밍 규칙 일관성 확인
- [ ] 불필요한 import 정리
- [ ] 타입 힌트 보완

## 🔄 운영 관련 (Operations)

### 1. 파일 라이프사이클 관리
- [ ] 처리 완료 후 GridFS 파일 삭제 정책
- [ ] 임시 파일 정리 스케줄러
- [ ] 스토리지 용량 모니터링

### 2. 백업 및 복구
- [ ] MongoDB 백업 전략
- [ ] Qdrant 스냅샷 관리
- [ ] 재난 복구 계획

## 📅 구현 우선순위

### Phase 1 (1주차) - 안정성
1. ✅ 데이터베이스 연결 관리 개선
2. ✅ 기본 에러 처리 구현
3. ✅ 로깅 시스템 구축

### Phase 2 (2주차) - 신뢰성
1. 트랜잭션 처리 추가
2. Dead Letter Queue 구현
3. 재시도 메커니즘

### Phase 3 (3주차) - 성능
1. 대용량 파일 처리
2. 배치 처리 최적화
3. 캐싱 구현

### Phase 4 (4주차) - 운영
1. 모니터링 대시보드
2. 파일 정리 자동화
3. 백업 시스템 구축

## 🔍 검토 필요 항목

### 아키텍처 결정
- [ ] 마이크로서비스 vs 모놀리스
- [ ] 동기 vs 비동기 처리 경계
- [ ] 이벤트 소싱 도입 여부

### 기술 스택
- [ ] Redis 필수 여부 검토
- [ ] Kafka 대신 더 간단한 메시지 큐 고려
- [ ] 벡터 DB 선택 재검토 (Qdrant vs Pinecone vs Weaviate)

## 📝 완료된 항목

### 시스템 초기화
- ✅ Docker 환경 구성
- ✅ Kafka 토픽 생성
- ✅ MongoDB 컬렉션 및 인덱스 생성
- ✅ Qdrant 벡터 컬렉션 생성

### API 구현
- ✅ PDF 업로드 엔드포인트
- ✅ 헬스체크 엔드포인트

### PDF 처리
- ✅ PDF Consumer 구현
- ✅ 텍스트 추출
- ✅ 청킹 서비스
- ✅ 임베딩 생성
- ✅ 배치 처리

## 💡 향후 고려사항

### 확장성
- 멀티 테넌시 지원
- 다국어 처리
- 새로운 파일 타입 추가 (DOCX, XLSX)

### 보안
- API 인증/인가
- 파일 암호화
- 민감 정보 마스킹

### 사용성
- 진행 상황 실시간 알림
- 배치 업로드 지원
- 웹 UI 개발

---

## 업데이트 방법
1. 작업 시작 시 해당 항목을 "진행 중"으로 표시
2. 완료 시 "완료된 항목"으로 이동
3. 새로운 이슈 발견 시 적절한 섹션에 추가
4. 주간 회고 시 우선순위 재조정



##PyMuPdf(fitz) 고려